---
- job-template:
    name: '{repo}-{container}-{tag}-{test}-run'
    builders:
      - shell: |
          docker run \
            -v /data/jenkins/workspace/$JOB_NAME:/var/lib/xtesting/results \
            {repo}/{container}:{tag} run_tests -t {test}
          mc cp -r /var/jenkins_home/workspace/$JOB_NAME/ \
            minio/{{ project }}/$JOB_NAME-$BUILD_ID
{% for suite in suites %}
- project:
    name: 'repo-container-tag-test-run'
    repo: '{{ suite.repo }}'
    container: '{{ suite.container }}'
    tag: '{{ suite.tag }}'
    test:
{% for test in suite.tests %}
      - {{ test }}
{% endfor %}
    jobs:
      - '{repo}-{container}-{tag}-{test}-run'
{% endfor %}
- job:
    name: '{{ project }}'
    project-type: multijob
    builders:
{% for suite in suites %}
      - multijob:
          name: {{ suite.repo }}/{{ suite.container }}:{{ suite.tag }}
          projects:
{% for test in suite.tests %}
            - name: '{{ suite.repo }}-{{ suite.container }}-{{ suite.tag }}-{{ test }}-run'
{% endfor %}
{% endfor %}
